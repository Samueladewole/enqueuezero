(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{232:function(t,e,r){"use strict";r.r(e);var a=r(0),s=Object(a.a)({},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content"},[t._m(0),t._v(" "),r("p"),t._m(1),r("p"),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),r("p",[t._v("HyperLogLog can provide estimated count on a very large data stream.")]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),r("p",[t._v("References:")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"http://blog.notdot.net/2012/09/Dam-Cool-Algorithms-Cardinality-Estimation",target:"_blank",rel:"noopener noreferrer"}},[t._v("Damn Cool Algorithms: Cardinality Estimation"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"http://www.moderndescartes.com/essays/hyperloglog/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Using Linear Counting, LogLog, and HyperLogLog to Estimate Cardinality"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://djhworld.github.io/hyperloglog/",target:"_blank",rel:"noopener noreferrer"}},[t._v("HyperLogLog  Playground"),r("OutboundLink")],1)])]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),r("p",[t._v("HyperLogLogPlusPlus is an enhancement of HyperLogLog.")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),r("p",[t._v("References:")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"http://antirez.com/news/75",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis new data structure: the HyperLogLog"),r("OutboundLink")],1),t._v(": If you're developing a web service, Redis might be a good choice.")]),t._v(" "),r("li",[r("a",{attrs:{href:"https://robots.thoughtbot.com/hyperloglogs-in-redis",target:"_blank",rel:"noopener noreferrer"}},[t._v("HyperLogLogs in Redis"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://redis.io/commands/pfadd",target:"_blank",rel:"noopener noreferrer"}},[t._v("PFADD"),r("OutboundLink")],1),t._v(": Add all the element arguments to the HyperLogLog data structure referenced as "),r("code",[t._v("key")]),t._v(".")]),t._v(" "),r("li",[r("a",{attrs:{href:"https://redis.io/commands/pfcount",target:"_blank",rel:"noopener noreferrer"}},[t._v("PFCOUNT"),r("OutboundLink")],1),t._v(": Get the approximated cardinality computed by the HyperLogLog data structure")]),t._v(" "),r("li",[r("a",{attrs:{href:"https://redis.io/commands/pfmerge",target:"_blank",rel:"noopener noreferrer"}},[t._v("PFMERGE"),r("OutboundLink")],1),t._v(": Merge multiple HyperLogLog values into one.")])]),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),r("p",[t._v("Run the script:")]),t._v(" "),t._m(17),r("p",[t._v("References:")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://ekzhu.github.io/datasketch/hyperloglog.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("datasketch - big data looks small"),r("OutboundLink")],1),t._v(": If you're trying to write a simple Python script to solve problem, datasketch might be a good choice.")])]),t._v(" "),t._m(18),t._v(" "),r("p",[t._v("Logswan can find unique IP addresses in very large log files but only consumes 4MB memory.")]),t._v(" "),t._m(19),r("p",[t._v("References:")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://www.logswan.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("logswan - Fast Web log analyzer using probabilistic data structures"),r("OutboundLink")],1),t._v(": Good choice for unique visitors counting on common logging file.")])]),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),r("p",[t._v("References:")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://gist.github.com/DavidJFelix/113fad6a0a7affdd880d",target:"_blank",rel:"noopener noreferrer"}},[t._v("A lab for HyperLogLogs using Redis & Python"),r("OutboundLink")],1)])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"hyperloglog"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglog"}},[this._v("#")]),this._v(" HyperLogLog")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"table-of-contents"},[r("ul",[r("li",[r("a",{attrs:{href:"#overview"}},[t._v("Overview")])]),r("li",[r("a",{attrs:{href:"#theory"}},[t._v("Theory")])]),r("li",[r("a",{attrs:{href:"#enhancements"}},[t._v("Enhancements")]),r("ul",[r("li",[r("a",{attrs:{href:"#hyperloglog"}},[t._v("HyperLogLog++")])])])]),r("li",[r("a",{attrs:{href:"#tools"}},[t._v("Tools")]),r("ul",[r("li",[r("a",{attrs:{href:"#redis"}},[t._v("Redis")])]),r("li",[r("a",{attrs:{href:"#datasketch"}},[t._v("Datasketch")])]),r("li",[r("a",{attrs:{href:"#logswan"}},[t._v("Logswan")])])])]),r("li",[r("a",{attrs:{href:"#strategies"}},[t._v("Strategies")]),r("ul",[r("li",[r("a",{attrs:{href:"#short-term-bucket-long-term-merge"}},[t._v("Short-term Bucket & Long-term Merge")])])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"overview"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[this._v("#")]),this._v(" Overview")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("HyperLogLog is an algorithm that can solve "),e("a",{attrs:{href:"count-distinct"}},[this._v("Count Distinct")]),this._v(" problem. A Count Distinct problem is something like getting number 5 for a data set like [1, 3, 2, 1, 5, 2, 4], for it has [1, 2, 3, 4, 5] 5 elements.")])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",[r("li",[t._v("Advantage\n"),r("ul",[r("li",[t._v("Fast (O(1)).")]),t._v(" "),r("li",[t._v("Memory efficient.")]),t._v(" "),r("li",[t._v("Can be distributed and paralleled.")])])]),t._v(" "),r("li",[t._v("Disadvantage\n"),r("ul",[r("li",[t._v("Only provides estimated count.")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"theory"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#theory"}},[this._v("#")]),this._v(" Theory")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Hash each item.")]),this._v(" "),e("li",[this._v("Place each item into 32 buckets based on first 5-bits of the hash.")]),this._v(" "),e("li",[this._v("Update value for each item in 32 buckets based on last 27-bits of the hash.")]),this._v(" "),e("li",[this._v("Apply to some fancy mathematical formulas to get the number based on the 32 buckets data.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"enhancements"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#enhancements"}},[this._v("#")]),this._v(" Enhancements")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"hyperloglog-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglog-2"}},[this._v("#")]),this._v(" HyperLogLog++")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Uses 64-bit integers rather than 32-bit")]),this._v(" "),e("li",[this._v("Sparse data structure rather than one huge array")]),this._v(" "),e("li",[this._v("Better bias correction algorithm at lower cardinalities.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"tools"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tools"}},[this._v("#")]),this._v(" Tools")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"redis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[this._v("#")]),this._v(" Redis")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Commands "),e("code",[this._v("PFADD")]),this._v(", "),e("code",[this._v("PFCOUNT")]),this._v(", and "),e("code",[this._v("PFMERGE")]),this._v(" are the main interfaces for manipulating HyperLogLog data structure in Redis.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('redis> PFADD hll a b c d e f g\n(integer) 1\nredis> PFCOUNT hll\n(integer) 7\n\nredis> PFADD hll1 foo bar zap a\n(integer) 1\nredis> PFADD hll2 a b c foo\n(integer) 1\nredis> PFMERGE hll3 hll1 hll2\n"OK"\nredis> PFCOUNT hll3\n(integer) 6\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"datasketch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#datasketch"}},[this._v("#")]),this._v(" Datasketch")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Source code of the script "),e("code",[this._v("test.py")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("from datasketch import HyperLogLog\n\ndata = [1, 2, 3, 5, 2, 4, 1, 6, 7]\n\nhll = HyperLogLog()\nfor element in data:\n    hll.update(str(element).encode('utf8'))\n\nprint(f'estimate: {hll.count()}')\nprint(f'real: {len(set(data))}')\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ mkdir testdatasketch\n$ python3 -mvenv venv\n$ source venv/bin/activate\n(venv) $ pip install datasketch\n(venv) $ python test.py\nestimate: 7.097484291802821\nreal: 7\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"logswan"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logswan"}},[this._v("#")]),this._v(" Logswan")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ logswan access.log\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"strategies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#strategies"}},[this._v("#")]),this._v(" Strategies")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"short-term-bucket-long-term-merge"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#short-term-bucket-long-term-merge"}},[this._v("#")]),this._v(" Short-term Bucket & Long-term Merge")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("Keep HyperLogLog data for every 10 minutes for the past 24 hours.")]),this._v(" "),e("li",[this._v("Merge HyperLogLog data into hourly HLL after 24 hours.")]),this._v(" "),e("li",[this._v("Merge HyperLogLog data into daily HLL after 60 days.")]),this._v(" "),e("li",[this._v("...")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Example redis usage: "),e("code",[this._v("PFADD users:<date>:<hour>:<MM> <UID>")]),this._v(", MM=[00, 10, 20, 30, 40, 50]")])}],!1,null,null,null);e.default=s.exports}}]);