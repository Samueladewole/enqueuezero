---
title: EnqueueZero Techshack 2019-01
published: false
description:
tags: enqueuezero
sidebar: auto
---

# EnqueueZero Techshack 2019-01

<TechshackHeader />

## How Discord Stores Billions of Messages

[blog.discordapp.com](https://blog.discordapp.com/how-discord-stores-billions-of-messages-7fa6ec7ee4c7)

The underlying database is Cassandra. Reasons of choosing Cassandra was:

* Read/Write ratio is about 50/50.
* Many random reads.
* Large dataset.
* Uneven amount of data for Private text chat heavy Discord servers and Large public Discord servers.

Requirements were:

* Linear scalability.
* Automatic failover.
* Low maintenance.
* Proven to work.
* Predictable performance.
* Not a blob store.
* Open source.

The data Modeling is to bucket messages by time. The primary key for `Message` is `((channel_id, bucket), message_id)`.

```
CREATE TABLE messages (
   channel_id bigint,
   bucket int,
   message_id bigint,
   author_id bigint,
   content text,
   PRIMARY KEY ((channel_id, bucket), message_id)
) WITH CLUSTERING ORDER BY (message_id DESC);
```

Cassandra is an AP database, meaning it trades Consistency with Availability. To solve the dilemma, engineers decided to delete records in the database if fault detected. The delete action is actually performed by a form of write called a “tombstone.” On read, it just skips over tombstones it comes across. The retention policy for tombstone is 2 days by default.

## Everything You Need To Know About Networking On AWS

[dev.to](https://dev.to/grahamlyons/everything-you-need-to-know-about-networking-on-aws-4bkf)

```
      +-------+
                                        | ig-1  |
                                        |       |
        vpc-123: 10.0.0.0/16  |         |       |        |
       +----------------------+---------+-------+--------+---------------------+
       |                      |                          |                     |
       |  +-----+             |  +-----+                 |  +-----+            |
       |  | NAT |             |  | NAT |                 |  | NAT |            |
public |  |     |             |  |     |                 |  |     |            |
subnets|  +-----+             |  +-----+                 |  +-----+            |
       |                      |                          |                     |
       |                      |                          |                     |
       |                      |                          |                     |
       |              +-------+                  +-------+             +-------+
       |              | rt-1a |                  | rt-1b |             | rt-1c |
       | 10.0.1.0/24  |       | 10.0.2.0/24      |       | 10.0.3.0/24 |       |
-------+-----------------------------------------------------------------------+
       | 10.0.4.0/24  | rt-2a | 10.0.5.0/24      | rt-2b | 10.0.6.0/24 | rt-2c |
       |              |       |                  |       |             |       |
       |              +-------+                  +-------+             +-------+
private|                      |                          |                     |
subnets|                      |                          |                     |
       |                      |                          |                     |
       |                      |                          |                     |
       |                      |                          |                     |
       |                      |                          |                     |
       |                      |                          |                     |
       |                      |                          |                     |
       +----------------------+--------------------------+---------------------+
       |         AZ 1         |          AZ 2            |        AZ 3         |
```

* A virtual private cloud or VPC is a private network space in which you can run your infrastructure.
  * It has an address space (CIDR range) which you choose e.g. 10.0.0.0/16. It determines how many IP address you can have.
* In VPC, there are public subnets and private subnets, depending on whether traffic can reach them from outside the VPC (the Internet).
* As long as one Availability Zone or AZ is alive, your service should be able to operate.
* A routing table contains rules about how IP packets in the subnets can travel to different IP addresses.
* Internet Gateways allows traffic going to outside world.
* A NAT gateway is a device which sits in the public subnets, accepts any IP packets bound for the Internet coming from the private subnets, sends those packets on to their destination and then sends the returning packets back to the source.
* A security groups can specify ingress (inbound) and egress (outbound) traffic rules, limiting them to certain sources (inbound) and destinations (outbound).

## An Idiot’s guide to Support vector machines (SVMs)

[web.mit.edu](http://web.mit.edu/6.034/wwwbob/svm-notes-long-08.pdf)

* Support vectors are the data points that lie closest to the decision surface. They are the data points most difficult to classify.
* ![Support Vector Machine](/static/images/2019-01-svm.png)

## How do you document a tech project with comics?

[jvns.ca](https://jvns.ca/blog/2018/12/09/how-do-you-document-a-tech-project-with-comics/)

* Comics without good information are useless.
* Focus on concepts that don’t change.
* Make a single graphic with a pretty small amount of information.
* Make a more in depth comic / illustration

## High Reliability Infrastructure Migrations

[youtube.com](https://www.youtube.com/watch?v=obB2IvCv-K0)

The topic is about how to improve the availability from 99% to 99.99%.

Below are solutions.

* Understand the design.
* Run gamedays.
* Classify failures.
* Have incidents only once.
* Make incremental changes.
* Always have a rollback plan.

It's okay to start out not being an expert but you need to become one!

## Introducing Pipelines to Airbnb’s Deployment Process

[medium.com](https://medium.com/airbnb-engineering/introducing-deploy-pipelines-to-airbnb-fc804ac2a157)

Check out this post on how Airbnb design the deployment process and minimize potential misuses.

* Develop a specification for a configuration file that service owners can use to define their deployment procedures (i.e. pipeline).
* Save pipeline configurations in a database.
* Give the frontend a method of accessing this data.
* Separate and order the targets correctly in the UI display.
* Disable targets that shouldn’t be deployed to (i.e. it has dependencies that have not yet been deployed to).
* Finally, implement the UI.
